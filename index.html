<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YEC Report Generator - Colorful & Fun Edition</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- html2pdf.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Quicksand:wght@600;700&family=Playfair+Display:wght@800;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background: #fdfdfd; }
        h1, h2, .font-fun { font-family: 'Quicksand', sans-serif; }
        .serif { font-family: 'Playfair Display', serif; }
        
        /* Highlight Stabilo Styles */
        .hl-green { background-color: #bef264; color: #166534; padding: 2px 4px; border-radius: 2px; font-weight: 700; }
        .hl-yellow { background-color: #fef08a; color: #854d0e; padding: 2px 4px; border-radius: 2px; font-weight: 700; }
        .hl-blue { background-color: #bae6fd; color: #0369a1; padding: 2px 4px; border-radius: 2px; font-weight: 700; }
        .hl-red { background-color: #fecaca; color: #991b1b; padding: 2px 4px; border-radius: 2px; font-weight: 700; }
        
        strong { font-weight: 700; color: #1e1b4b; }
        
        /* PDF & Preview Optimization */
        .prevent-split { 
            break-inside: avoid; 
            page-break-inside: avoid; 
        }

        /* Container pratinjau agar tidak terpotong di layar kecil */
        .preview-area {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            overflow-x: auto;
            background: #f1f5f9;
            padding: 40px 20px;
        }

        #report-content {
            width: 800px; 
            min-height: 1130px; /* Mendekati rasio A4 */
            background: white;
            flex-shrink: 0; /* Menjaga ukuran tetap 800px untuk render PDF */
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15);
        }

        @media print {
            .no-print { display: none !important; }
            body { background: white !important; padding: 0; }
            #report-content { box-shadow: none !important; border: none !important; margin: 0 !important; }
            .preview-area { padding: 0; background: white; }
        }

        /* Custom Scrollbar */
        textarea::-webkit-scrollbar { width: 8px; }
        textarea::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }

        .gradient-main {
            background: linear-gradient(135deg, #f97316 0%, #db2777 50%, #6366f1 100%);
        }

        .observation-container {
            text-align: justify;
            line-height: 1.9;
            white-space: pre-line;
        }

        .likert-step {
            transition: all 0.3s ease;
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="min-h-screen">

    <div class="flex flex-col lg:flex-row min-h-screen">
        
        <!-- PANEL INPUT (KIRI) -->
        <div class="lg:w-[420px] w-full bg-white border-r border-slate-200 p-8 space-y-8 no-print overflow-y-auto max-h-screen">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3 text-orange-600 font-bold text-2xl font-fun">
                    <div class="bg-orange-100 p-2 rounded-xl">
                        <i data-lucide="palette" class="w-6 h-6"></i>
                    </div>
                    <span>YEC Builder</span>
                </div>
                <button onclick="resetForm()" class="text-slate-400 hover:text-red-500 p-2 transition-all">
                    <i data-lucide="refresh-cw" class="w-5 h-5"></i>
                </button>
            </div>

            <!-- Form Identitas -->
            <div class="space-y-5">
                <h2 class="text-[11px] font-black text-slate-400 uppercase tracking-[0.2em] flex items-center gap-2">
                    <i data-lucide="user" class="w-4 h-4"></i> Informasi Siswa
                </h2>
                <div class="grid gap-4">
                    <input id="namaLengkap" type="text" oninput="updatePreview()" class="w-full px-5 py-3.5 bg-slate-50 border border-slate-200 focus:border-orange-300 focus:ring-4 focus:ring-orange-50 rounded-2xl outline-none transition-all font-medium" placeholder="Nama Lengkap">
                    <input id="namaPanggilan" type="text" oninput="updatePreview()" class="w-full px-5 py-3.5 bg-slate-50 border border-slate-200 focus:border-orange-300 focus:ring-4 focus:ring-orange-50 rounded-2xl outline-none transition-all font-bold text-orange-600" placeholder="Nama Panggilan">
                    <input id="nilaiAkhir" type="number" oninput="updatePreview()" class="w-full px-5 py-3.5 bg-slate-50 border border-slate-200 focus:border-orange-300 focus:ring-4 focus:ring-orange-50 rounded-2xl outline-none transition-all font-black text-2xl text-indigo-600" placeholder="Skor Akhir (0-100)">
                </div>
            </div>

            <!-- Form Skor -->
            <div class="space-y-5 pt-4">
                <h2 class="text-[11px] font-black text-slate-400 uppercase tracking-[0.2em] flex items-center gap-2">
                    <i data-lucide="award" class="w-4 h-4"></i> Level Kompetensi
                </h2>
                <div id="skor-container" class="space-y-6">
                    <!-- Dinamis via JS -->
                </div>
            </div>

            <!-- Form Catatan -->
            <div class="space-y-4 pt-4 pb-10">
                <h2 class="text-[11px] font-black text-slate-400 uppercase tracking-[0.2em] flex items-center gap-2">
                    <i data-lucide="message-circle" class="w-4 h-4"></i> Catatan Mentor
                </h2>
                <textarea id="rawNotes" oninput="updatePreview()" class="w-full px-5 py-5 bg-slate-50 border border-slate-200 focus:border-teal-300 focus:ring-4 focus:ring-teal-50 rounded-[1.5rem] text-sm outline-none h-48 resize-none leading-relaxed transition-all" placeholder="Tuliskan perkembangan siswa secara detail..."></textarea>
            </div>
        </div>

        <!-- PRATINJAU LAPORAN (KANAN) -->
        <div class="flex-1 preview-area no-scrollbar relative">
            
            <!-- Tombol Aksi Melayang -->
            <div class="fixed bottom-8 right-8 z-50 no-print flex flex-col gap-4">
                <button onclick="window.print()" class="bg-white text-slate-600 p-4 rounded-2xl shadow-2xl hover:bg-slate-50 transition-all border border-slate-200 group">
                    <i data-lucide="printer" class="w-6 h-6 group-hover:scale-110"></i>
                </button>
                <button onclick="downloadPDF()" class="bg-orange-500 hover:bg-orange-600 text-white px-8 py-4 rounded-2xl shadow-2xl transition-all flex items-center gap-3 font-bold transform hover:-translate-y-1 text-sm">
                    <i data-lucide="file-down" class="w-6 h-6"></i> Simpan PDF
                </button>
            </div>

            <div id="report-content" class="rounded-[2.5rem] overflow-hidden relative">
                
                <div class="relative z-10 min-h-full flex flex-col text-slate-800">
                    <!-- Colorful Header -->
                    <div class="gradient-main p-16 text-center text-white relative prevent-split">
                        <div class="absolute inset-0 opacity-10 pointer-events-none">
                            <svg class="w-full h-full" viewBox="0 0 100 100" preserveAspectRatio="none"><path d="M0 100 C 20 0 50 0 100 100 Z" fill="white"></path></svg>
                        </div>
                        <h1 class="text-3xl md:text-4xl font-black mb-3 tracking-tight uppercase drop-shadow-lg font-fun">Monthly Observation Report</h1>
                        <div class="inline-flex items-center gap-4 px-6 py-2 bg-black/10 backdrop-blur-md rounded-full border border-white/20 font-fun">
                            <div class="w-2 h-2 bg-green-400 rounded-full animate-ping"></div>
                            <span class="tracking-[0.3em] uppercase text-[10px] font-bold">Public Speaking Anak Reguler</span>
                        </div>
                    </div>

                    <!-- Profile Section -->
                    <div class="px-12 -mt-8 prevent-split">
                        <div class="bg-white rounded-[2.5rem] shadow-xl p-8 flex items-center justify-between border border-slate-100">
                            <div class="flex-1">
                                <p class="text-[9px] text-slate-400 uppercase font-black tracking-[0.3em] mb-1">Nama Lengkap</p>
                                <p id="view-namaLengkap" class="text-xl font-bold text-slate-800 truncate">—</p>
                            </div>
                            <div class="w-px h-12 bg-slate-100 mx-6"></div>
                            <div class="flex-1 text-center">
                                <p class="text-[9px] text-indigo-400 uppercase font-black tracking-[0.3em] mb-1">Nama Panggilan</p>
                                <p id="view-namaPanggilan" class="text-3xl font-black text-orange-500 tracking-tight leading-none">—</p>
                            </div>
                            <div class="w-px h-12 bg-slate-100 mx-6"></div>
                            <div class="flex-1 text-right">
                                <p class="text-[9px] text-teal-500 uppercase font-black tracking-[0.3em] mb-1">Skor Akhir</p>
                                <div class="flex items-baseline justify-end">
                                    <span id="view-nilaiAkhir" class="text-5xl font-black text-indigo-950 leading-none">0</span>
                                    <span class="text-lg font-bold text-slate-300 ml-1">/100</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Kompetensi Section -->
                    <div class="p-12 prevent-split flex-grow">
                        <div class="flex items-center gap-4 mb-10">
                            <div class="h-8 w-2 bg-orange-400 rounded-full shadow-sm"></div>
                            <h2 class="text-2xl font-black text-indigo-950 uppercase tracking-tighter">Matriks Capaian Kompetensi</h2>
                        </div>
                        <div id="progress-visuals" class="grid grid-cols-2 gap-x-12 gap-y-10">
                            <!-- JS Rendered -->
                        </div>
                        
                        <!-- Ringkasan Nilai -->
                        <div class="mt-12 bg-slate-50 border border-slate-100 p-8 rounded-[2rem] flex items-center justify-between">
                            <div class="flex items-center gap-4">
                                <div class="w-14 h-14 bg-indigo-600 rounded-2xl flex items-center justify-center text-white shadow-lg">
                                    <i data-lucide="trending-up" class="w-8 h-8"></i>
                                </div>
                                <div>
                                    <p class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Performance Index</p>
                                    <h3 class="text-xl font-bold text-indigo-900">Evaluasi Sesi Belajar</h3>
                                </div>
                            </div>
                            <div class="text-right">
                                <span id="view-totalScore" class="text-6xl font-black text-indigo-950 tracking-tighter">0</span>
                                <span class="text-2xl font-bold text-orange-400">%</span>
                            </div>
                        </div>
                    </div>

                    <!-- Catatan Section -->
                    <div class="p-12 pt-0 prevent-split">
                        <div class="bg-indigo-950 rounded-[3rem] p-12 text-white relative overflow-hidden">
                            <div class="absolute top-0 right-0 w-32 h-32 bg-white/5 rounded-full -mr-10 -mt-10"></div>
                            <div class="flex items-center gap-4 mb-8">
                                <div class="h-8 w-2 bg-teal-400 rounded-full"></div>
                                <h2 class="text-2xl font-black uppercase tracking-tighter">Catatan Observasi</h2>
                            </div>
                            <div id="view-notes" class="observation-container text-indigo-50/90 text-[16px] font-normal px-2">
                                <p class="italic text-indigo-300/50 text-center py-6">Silakan tuliskan evaluasi mentor pada panel input.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Footer Signature -->
                    <div class="p-12 mt-auto prevent-split">
                        <div class="flex justify-between items-end border-t-2 border-dashed border-slate-100 pt-10">
                            <div class="max-w-[300px]">
                                <div class="flex items-center gap-2 mb-4">
                                    <i data-lucide="check-circle" class="w-5 h-5 text-green-500"></i>
                                    <span class="text-[10px] font-black uppercase tracking-widest text-slate-500">Verified by YEC.CO.ID</span>
                                </div>
                                <p class="text-[10px] text-slate-400 italic leading-relaxed">
                                    Laporan ini disusun secara profesional untuk mendukung transparansi perkembangan bakat komunikasi anak.
                                </p>
                            </div>
                            <div class="text-center min-w-[200px]">
                                <div class="w-full h-px bg-slate-200 mb-4"></div>
                                <p class="text-[11px] font-black text-slate-800 uppercase tracking-widest font-fun">Instruktur Utama</p>
                                <p class="text-[9px] text-indigo-500 mt-1 font-black">YEC PROFESSIONAL EDUCATION</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- STATE & CONFIG ---
        let state = {
            namaLengkap: '', 
            namaPanggilan: '', 
            nilaiAkhir: '', 
            rawNotes: '',
            skor: {
                vokal: 3,
                respon: 3,
                tubuh: 3,
                sosial: 2,
                mental: 3
            }
        };

        const config = {
            vokal: { label: "Artikulasi & Proyeksi", color: "#f97316", icon: "mic" },
            respon: { label: "Interaksi & Respons", color: "#6366f1", icon: "message-square" },
            tubuh: { label: "Bahasa Tubuh", color: "#10b981", icon: "user-check" },
            sosial: { label: "Dinamika Kelompok", color: "#ec4899", icon: "users" },
            mental: { label: "Kontrol Kecemasan", color: "#0ea5e9", icon: "shield" }
        };

        // --- UI RENDER ---
        function renderInputs() {
            const container = document.getElementById('skor-container');
            container.innerHTML = Object.entries(config).map(([key, item]) => `
                <div class="space-y-3">
                    <label class="text-[10px] font-black text-slate-500 uppercase tracking-widest flex items-center gap-2">
                        <i data-lucide="${item.icon}" class="w-3.5 h-3.5"></i> ${item.label}
                    </label>
                    <div class="flex gap-2" data-aspek="${key}">
                        ${[1, 2, 3, 4].map(n => `
                            <button onclick="setSkor('${key}', ${n})" class="skor-btn flex-1 py-2.5 rounded-xl text-xs font-bold transition-all border-2 ${state.skor[key] === n ? 'bg-indigo-600 border-indigo-600 text-white shadow-lg' : 'bg-white border-slate-100 text-slate-400 hover:border-indigo-200'}">${n}</button>
                        `).join('')}
                    </div>
                </div>
            `).join('');
            lucide.createIcons();
        }

        function setSkor(aspek, val) {
            state.skor[aspek] = val;
            renderInputs();
            updateVisuals();
        }

        function updatePreview() {
            state.namaLengkap = document.getElementById('namaLengkap').value;
            state.namaPanggilan = document.getElementById('namaPanggilan').value;
            state.nilaiAkhir = document.getElementById('nilaiAkhir').value;
            state.rawNotes = document.getElementById('rawNotes').value;

            document.getElementById('view-namaLengkap').innerText = state.namaLengkap || "—";
            document.getElementById('view-namaPanggilan').innerText = state.namaPanggilan || "—";
            document.getElementById('view-nilaiAkhir').innerText = state.nilaiAkhir || "0";
            document.getElementById('view-totalScore').innerText = state.nilaiAkhir || "0";
            
            processNotesDisplay();
            updateVisuals();
        }

        function processNotesDisplay() {
            const container = document.getElementById('view-notes');
            let text = state.rawNotes.trim();

            if (!text) {
                container.innerHTML = '<p class="italic text-indigo-300/50 text-center py-10">Catatan mentor akan tertulis di sini.</p>';
                return;
            }

            const rules = [
                { reg: /\b(bagus|baik|unggul|hebat|luar biasa|percaya diri|jernih|stabil|tepat|natural|lancar|berani)\b/gi, class: 'hl-green' },
                { reg: /\b(kurang|belum|perlu|lambat|cepat|lemah|tidak stabil|fidgeting|gelisah|malu|ragu)\b/gi, class: 'hl-red' },
                { reg: /\b(progres|kemajuan|berkembang|meningkat|mulai|upaya|aktif)\b/gi, class: 'hl-blue' },
                { reg: /\b(latihan|fokus|perhatian|rekomendasi|saran|lanjutkan|rutin|disarankan)\b/gi, class: 'hl-yellow' }
            ];

            let html = text.split('\n').map(p => {
                if (!p.trim()) return '';
                let processedPara = p;
                processedPara = processedPara.replace(/\*(.*?)\*/g, '<strong>$1</strong>');
                rules.forEach(rule => {
                    processedPara = processedPara.replace(rule.reg, `<span class="${rule.class}">$1</span>`);
                });
                return `<p class="mb-4">${processedPara}</p>`;
            }).join('');

            container.innerHTML = html;
        }

        function updateVisuals() {
            const container = document.getElementById('progress-visuals');
            container.innerHTML = Object.entries(config).map(([key, item]) => {
                const val = state.skor[key];
                return `
                    <div class="prevent-split">
                        <div class="flex justify-between mb-3 items-center">
                            <span class="text-[10px] font-black text-slate-500 uppercase tracking-widest">${item.label}</span>
                            <div class="flex gap-1">
                                ${[1, 2, 3, 4].map(i => `
                                    <div class="w-4 h-1.5 rounded-full ${i <= val ? '' : 'bg-slate-100'}" style="${i <= val ? 'background-color:' + item.color : ''}"></div>
                                `).join('')}
                            </div>
                        </div>
                        <div class="flex items-center gap-2">
                            ${[1, 2, 3, 4].map(i => {
                                const isActive = i <= val;
                                const baseStyle = isActive ? `background-color: ${item.color}; border-color: ${item.color};` : 'background-color: #f8fafc; border-color: #f1f5f9;';
                                return `<div class="likert-step flex-1 h-6 rounded-lg border-2 shadow-sm transition-all" style="${baseStyle} opacity: ${isActive ? '1' : '0.1'}"></div>`;
                            }).join('')}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function resetForm() {
            if (confirm("Hapus semua data input?")) location.reload();
        }

        function downloadPDF() {
            const element = document.getElementById('report-content');
            const opt = {
                margin: 0,
                filename: `Report_YEC_${state.namaPanggilan || 'Student'}.pdf`,
                image: { type: 'jpeg', quality: 1 },
                html2canvas: { 
                    scale: 2, 
                    useCORS: true, 
                    letterRendering: true, 
                    scrollY: 0,
                    width: 800 
                },
                jsPDF: { unit: 'px', format: [800, 1131], orientation: 'portrait', hotfixes: ['px_scaling'] }
            };
            
            window.scrollTo(0,0);
            html2pdf().set(opt).from(element).save();
        }

        window.onload = () => { 
            lucide.createIcons(); 
            renderInputs(); 
            updatePreview(); 
        };
    </script>
</body>
</html>
